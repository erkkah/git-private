# git-private

`git-private` lets you store private data inside a `git` repo. A typical example is configuration files with API keys, et.c.

`git-private` encrypts your private files and keeps track of a list of public keys for users that should have access to these files. The complete state (encrypted files and public keys) is kept directly in the `git` repo, there are no external dependencies.

Encryption is provided by [age](https://github.com/FiloSottile/age), using either `age` or `ssh` keys pairs.

## Getting started

* [Install](#Installation) `git-private`
* In your repo, run `git private init`
* Add the public key of the first user (most likely you): `git private keys add -pubkey ~/.ssh/id_rsa.pub`
* Add your private file: `git private add apikeys.json`
* Hide (encrypt) the added file: `git private hide -keyfile ~/.ssh/id_rsa`

Now, commit your changes. In this example, the changed files are:

* `.gitprivate/*`
* `.gitignore`
* `apikeys.json.private`

Note:

*  The original file, `apikeys.json` is not added, and that it is added to `.gitignore` automatically.
* The `git-private` state lives in `.gitprivate/`.
* The `hide` command encrypts all files tracked by `git-private`.
* A user's private key should ***never*** be added to the git repo!

## Revealing hidden files

Use `git private reveal` to reveal hidden files. This is needed after cloning a repo or when pulling changes to private files or keys.

## Managing keys

The `keys` command is used to list, add, remove or generate keys.

Note that except for the first key added, you need to be in the `git-private` key list to be able to access the key list.

### `age` keys

`git-private` supports `age` keys as produced by the `age-keygen` tool. Keys can also be generated by `git private keys generate`. The tool will prompt for a passphrase, which will be used to encrypt the generated private key. If no passphrase is entered, the private key will be stored in clear text, just like with the `age-keygen` tool.

### `ssh` keys

To simplify adoption of the tool, you can use existing `ssh` keys with `git-private`.

Note that `ssh-agent` is not supported, passphrases need to be entered on each encryption operation.

### Configure private key

To avoid having to specify the private key file on the command line, the private key can be specified by environment variables in two different ways:

* `GIT_PRIVATE_KEY`="private key data here"
* `GIT_PRIVATE_KEYFILE`="path to private key file here"

## Checking status

In general, the tool refuses to overwrite existing files without specifying the `force` flag.
The tool keeps a hash of the last hidden version of a file, and uses that hash to check if currently revealed files are different.

Use `git private status` to check the status of files tracked by `git-private`.

## Installation

Get pre-built binaries from [github](https://github.com/erkkah/git-private), or install using your local go toolchain:

```
$ go install github.com/erkkah/git-private
```

## CI/CD integration

To use `git-private` in automated build flows, create a keypair without passphrase using `git private keys generate`. Then add the public key to the key list (`git private keys add`...).

Use the secure variables storage feature of your CI/CD system to store the private key, and make sure `git-private` can read the key from the `GIT-PRIVATE-KEY` environment variable.

Then use `git private reveal` to reveal all files needed for the build.

## Inspiration

This project is highly inspired by [git-secret](https://git-secret.io/), and attempts to provide the same functionality without dependencies to PGP and lots of shell stuff.

https://latacora.micro.blog/2019/07/16/the-pgp-problem.html

## Storage structure

All metadata lives in `.gitprivate`, file info in `files.json` and key info in `keys.dat`.

## TODO

* Add support for read-only keys
* Skip auto-hide after key change if out of sync, complain and instruct user
* Improved usage text
* Nicer error messages
* Docs
